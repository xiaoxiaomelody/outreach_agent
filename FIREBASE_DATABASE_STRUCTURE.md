# ğŸ—„ï¸ Firebase Database Structure

## What Appears in Your Firestore Database

When users interact with your app, here's exactly what data gets stored in Firebase Firestore.

---

## ğŸ“Š Database Collections

### 1. **Firebase Authentication** (Not Firestore - separate service)

This is managed automatically by Firebase Auth and stores:
- User email
- Hashed password
- UID (User ID)
- Sign-in methods
- Email verification status

**You don't manually create this** - Firebase handles it when users sign up!

**Where to see it:**
- Firebase Console â†’ Authentication â†’ Users tab

---

### 2. **`users` Collection** (Firestore)

Stores user profile information.

#### Structure:
```
users/
  â””â”€â”€ {userId}/                    # Document ID = Firebase Auth UID
        â”œâ”€â”€ name: "John Doe"       # Optional
        â”œâ”€â”€ bio: "..."             # Optional
        â”œâ”€â”€ photoURL: "..."        # Optional
        â””â”€â”€ [any custom fields]    # Whatever you PUT to /api/user/profile
```

#### When is it created?
- **Automatically** when a user updates their profile via `PUT /api/user/profile`
- Example:
  ```javascript
  await api.updateProfile({ 
    name: "John Doe", 
    bio: "Software Developer" 
  });
  ```

#### Example Document:

**Document ID:** `abc123xyz` (the user's Firebase UID)

```json
{
  "name": "John Doe",
  "bio": "Full-stack developer",
  "photoURL": "https://example.com/photo.jpg",
  "city": "New York",
  "lastUpdated": "2025-11-16T12:00:00Z"
}
```

---

### 3. **Custom Data Collections** (Dynamic)

Your backend supports creating ANY collection name. Users can store posts, todos, notes, etc.

#### Structure:
```
{collectionName}/
  â””â”€â”€ {autoGeneratedId}/
        â”œâ”€â”€ userId: "abc123xyz"           # Automatically added
        â”œâ”€â”€ createdAt: Timestamp          # Automatically added
        â”œâ”€â”€ updatedAt: Timestamp          # Added on update
        â””â”€â”€ [your custom fields]          # Whatever data you send
```

#### Common Examples:

---

### Example 1: **`posts` Collection**

When you create a post:
```javascript
await api.createData('posts', {
  title: "My First Post",
  content: "Hello World!",
  tags: ["javascript", "firebase"]
});
```

**Firestore Document:**
```
posts/
  â””â”€â”€ xyz789abc/                    # Auto-generated document ID
        â”œâ”€â”€ userId: "abc123xyz"     # Your user ID (auto-added)
        â”œâ”€â”€ createdAt: Nov 16, 2025 # Timestamp (auto-added)
        â”œâ”€â”€ title: "My First Post"  # Your data
        â”œâ”€â”€ content: "Hello World!" # Your data
        â””â”€â”€ tags: ["javascript", "firebase"]
```

---

### Example 2: **`todos` Collection**

```javascript
await api.createData('todos', {
  task: "Buy groceries",
  completed: false,
  priority: "high"
});
```

**Firestore Document:**
```
todos/
  â””â”€â”€ def456ghi/
        â”œâ”€â”€ userId: "abc123xyz"
        â”œâ”€â”€ createdAt: Nov 16, 2025
        â”œâ”€â”€ task: "Buy groceries"
        â”œâ”€â”€ completed: false
        â””â”€â”€ priority: "high"
```

---

### Example 3: **`contacts` Collection**

```javascript
await api.createData('contacts', {
  name: "Jane Smith",
  email: "jane@example.com",
  phone: "555-1234",
  company: "Tech Corp"
});
```

**Firestore Document:**
```
contacts/
  â””â”€â”€ jkl012mno/
        â”œâ”€â”€ userId: "abc123xyz"
        â”œâ”€â”€ createdAt: Nov 16, 2025
        â”œâ”€â”€ name: "Jane Smith"
        â”œâ”€â”€ email: "jane@example.com"
        â”œâ”€â”€ phone: "555-1234"
        â””â”€â”€ company: "Tech Corp"
```

---

## ğŸ” What Your Firebase Console Will Look Like

### Initially (After First User Signs Up):

```
Firebase Console â†’ Firestore Database

Collections:
  (empty - no collections yet)
```

The `users` collection doesn't exist until someone updates their profile!

---

### After User Updates Profile:

```
Collections:
  ğŸ“ users
     â””â”€â”€ ğŸ“„ abc123xyz
         â€¢ name: "John Doe"
         â€¢ bio: "Developer"
```

---

### After Creating Some Data:

```
Collections:
  ğŸ“ users
     â””â”€â”€ ğŸ“„ abc123xyz
         â€¢ name: "John Doe"
         
  ğŸ“ posts
     â”œâ”€â”€ ğŸ“„ xyz789abc
     â”‚   â€¢ userId: "abc123xyz"
     â”‚   â€¢ title: "My First Post"
     â”‚   â€¢ createdAt: Timestamp
     â”‚
     â””â”€â”€ ğŸ“„ pqr345stu
         â€¢ userId: "abc123xyz"
         â€¢ title: "Second Post"
         â€¢ createdAt: Timestamp
         
  ğŸ“ todos
     â”œâ”€â”€ ğŸ“„ def456ghi
     â”‚   â€¢ userId: "abc123xyz"
     â”‚   â€¢ task: "Buy groceries"
     â”‚   â€¢ completed: false
     â”‚
     â””â”€â”€ ğŸ“„ vwx678yza
         â€¢ userId: "abc123xyz"
         â€¢ task: "Finish project"
         â€¢ completed: true
```

---

## ğŸ“‹ Data Fields Explained

### Automatically Added Fields

Your backend **automatically adds** these fields to every document:

| Field | Type | When Added | Description |
|-------|------|------------|-------------|
| `userId` | String | On CREATE | Firebase UID of the user who created it |
| `createdAt` | Timestamp | On CREATE | Server timestamp when document was created |
| `updatedAt` | Timestamp | On UPDATE | Server timestamp when document was updated |

### Your Custom Fields

Any other fields come from the data YOU send:

```javascript
// You send:
{
  title: "My Title",
  content: "My Content",
  tags: ["tag1", "tag2"]
}

// Backend stores:
{
  userId: "abc123xyz",        // â† Backend adds
  createdAt: Timestamp,        // â† Backend adds
  title: "My Title",           // â† Your data
  content: "My Content",       // â† Your data
  tags: ["tag1", "tag2"]       // â† Your data
}
```

---

## ğŸ” Security: User Data Isolation

### Important: Users can only see THEIR OWN data!

When you call `GET /api/data/posts`, the backend automatically filters:

```javascript
// Backend code (line 146):
.where('userId', '==', req.user.uid)
```

This means:
- User A can only see documents where `userId` = User A's UID
- User B can only see documents where `userId` = User B's UID
- **No user can see another user's data!**

---

## ğŸ§ª How to Test / View Your Database

### Method 1: Firebase Console (Easiest)

1. Go to: https://console.firebase.google.com
2. Select your project: `cs32fp-dd790`
3. Click **Firestore Database** in left menu
4. You'll see all collections and documents

### Method 2: Code (Add to Dashboard)

Add this to your frontend Dashboard component:

```javascript
import { api } from '../api/backend';

// Get user profile
const profile = await api.getProfile();
console.log('Profile:', profile);

// Get posts
const posts = await api.getData('posts');
console.log('Posts:', posts);
```

### Method 3: Browser Console

After signing in:

```javascript
// Get profile
const profile = await api.getProfile();
console.log(profile);

// Create a post
const newPost = await api.createData('posts', {
  title: 'Test Post',
  content: 'This is a test'
});
console.log(newPost);

// Get all posts
const posts = await api.getData('posts');
console.log(posts);
```

---

## ğŸ’¡ Example: Full User Journey

### 1. User Signs Up

```javascript
// Frontend: Sign up
signUpWithEmail('user@example.com', 'password123');
```

**Firebase Auth Database:**
```
Users:
  - UID: abc123xyz
  - Email: user@example.com
  - Password: (hashed)
```

**Firestore:**
```
(No collections yet)
```

---

### 2. User Updates Profile

```javascript
await api.updateProfile({
  name: 'John Doe',
  bio: 'Developer',
  location: 'NYC'
});
```

**Firestore:**
```
users/
  â””â”€â”€ abc123xyz/
      â€¢ name: "John Doe"
      â€¢ bio: "Developer"
      â€¢ location: "NYC"
```

---

### 3. User Creates a Post

```javascript
await api.createData('posts', {
  title: 'First Post',
  content: 'Hello!'
});
```

**Firestore:**
```
users/
  â””â”€â”€ abc123xyz/ (profile)
  
posts/
  â””â”€â”€ xyz789abc/
      â€¢ userId: "abc123xyz"
      â€¢ createdAt: Timestamp
      â€¢ title: "First Post"
      â€¢ content: "Hello!"
```

---

### 4. User Creates a Todo

```javascript
await api.createData('todos', {
  task: 'Learn Firebase',
  done: false
});
```

**Firestore:**
```
users/
  â””â”€â”€ abc123xyz/ (profile)
  
posts/
  â””â”€â”€ xyz789abc/ (first post)
  
todos/
  â””â”€â”€ def456ghi/
      â€¢ userId: "abc123xyz"
      â€¢ createdAt: Timestamp
      â€¢ task: "Learn Firebase"
      â€¢ done: false
```

---

## ğŸ¯ Quick Reference: API â†’ Database Mapping

| API Call | Firestore Action | What Gets Created |
|----------|------------------|-------------------|
| `api.getProfile()` | Read from `users/{uid}` | Nothing (just reads) |
| `api.updateProfile(data)` | Write to `users/{uid}` | Document in `users/` collection |
| `api.createData('posts', data)` | Add to `posts/` | New document in `posts/` with `userId` |
| `api.getData('posts')` | Query `posts/` where userId = current user | Nothing (just reads) |
| `api.updateData('posts', id, data)` | Update `posts/{id}` | Updates existing document |
| `api.deleteData('posts', id)` | Delete `posts/{id}` | Removes document |

---

## ğŸ”§ Firestore Security Rules (Important!)

Your backend verifies authentication, but you should ALSO set Firestore rules:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users collection
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Any other collection
    match /{collection}/{document} {
      allow read, write: if request.auth != null && 
                           resource.data.userId == request.auth.uid;
    }
  }
}
```

**Set these in Firebase Console â†’ Firestore Database â†’ Rules tab**

---

## ğŸ“Š Database Growth Example

**Day 1 (1 user, 0 actions):**
```
Collections: 0
Documents: 0
```

**Day 1 (1 user, updated profile):**
```
Collections: 1 (users)
Documents: 1
```

**Day 1 (1 user, created 3 posts):**
```
Collections: 2 (users, posts)
Documents: 4 (1 user + 3 posts)
```

**Day 7 (10 users, 50 posts, 100 todos):**
```
Collections: 3 (users, posts, todos)
Documents: 160 (10 users + 50 posts + 100 todos)
```

---

## âœ… Summary

**What you'll see in Firestore:**

1. **`users/` collection** - One document per user with profile info
2. **Custom collections** - Any collections you create (`posts`, `todos`, `contacts`, etc.)
3. **Each document has:**
   - `userId` - Who owns it
   - `createdAt` - When it was created
   - `updatedAt` - When it was last modified (if applicable)
   - Your custom fields

**Key Points:**
- Collections are created automatically when you first add data
- Each user only sees their own data (filtered by `userId`)
- Firebase Auth users are separate from Firestore data
- You can create any collection name dynamically

---

## ğŸ†˜ Troubleshooting

### "I don't see any collections"
â†’ Create some data first! Collections appear when you add the first document.

### "I see another user's data"
â†’ Check your Firestore security rules. Backend handles this, but rules add extra protection.

### "userId is missing"
â†’ Check that you're authenticated when making API calls.

### "createdAt shows weird timestamp"
â†’ That's normal! It's a Firestore Timestamp object. Convert it: `timestamp.toDate()`

---

## ğŸ“– Next Steps

1. **Create test data** via your app
2. **Check Firebase Console** to see your data
3. **Set Firestore Security Rules** for extra protection
4. **Build your app features** around these collections!

